---
layout:     post
title:      "Linux系统故障处理（一）"
subtitle:   ""
date:       2017-07-08 00:36:00
author:     "lyremelody"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - 运维
---


工作到现在，基于Linux系统工作已经好多年了，遇到过不少问题，也处理过不少问题。

从前少有记录，最近考虑逐渐总结一下。

今天总结两个问题：
1. 开机进不了系统
2. 服务接口无法远程访问

## 故障一：开机进不了系统
---
### 可能的现象：“Operating System not found”

是不是没装操作系统？当然，有可能。这种情况，插入光盘装个系统便是。

如果装了系统，还有这个错误，那么有可能是BIOS没有选择安装了系统的设备。解决方案就是，重启机器，进入BIOS（有的机器是按F2），在“Boot”标签页下，将安装了系统的设备名称移到首位。

如果还是出现这个现象，可能是由于之前非正常关机，或者修改系统导致的grub信息丢失（比如，之前我会在某机器上制作启动U盘，有时会出现这种问题）。这种情况的解决方案，插入系统启动盘(启动U盘)，从光盘启动，修复grub信息：
> grub> root(hd0,0)
>
> grub> setup(hd0)
>
> grub> exit

### 可能的现象：文件系统错误，比如启动信息出现 “/dev/sda2 contains a file system with errors...”，然后进入了命令行界面。

这个应该是之前异常掉电，导致的文件系统错误。解决方案是，采用fsck修复出问题的设备。先卸载设备
> umount /dev/sda2

如果sda2是ext3系统，则按如下命令修复
> fsck.ext3 -y /dev/sda2

之后重启即可。

### 可能的现象：系统盘空间满了。比如启动信息出现“No space left on device...”

这个是系统盘空间满了，可能是某些系统的日志占满的、也可能是数据卷掉线，数据写入的挂载目录实际上是在系统盘设备上，导致系统启动过程中，某些服务无法写入临时文件而卡住。解决方案是，在启动过程中，出现系统内核菜单选项的时候，按"e"，编辑grub配置，加入single选项，进入单人模式。（或者通过U盘启动，挂载设备到U盘系统某目录，这个要注意后面在这个目录下查看空间）

然后通过du看哪些目录或文件比较异常，然后删除这些文件（无用文件或者日志）。比如
> du /var/log -sh

然后看到/var/log目录下xxx.log占用了10GB空间，这时，清空这个文件即可。

总结一下：遇到问题，首先是关注错误输出，然后根据错误信息定位可能的问题。

## 故障二：服务（比如MySQL、Nginx、Apache、xxx等）正常启动了，但是无法在其他机器上访问
---
可能的原因，网络不通。可通过ping来判断。网络问题后面再总结。

还可能的原因，SELinux开启。

可通过getenforce查看，如果结果是Enforcing，那么简单的方式就是关闭SELinux：
> setenforce 0

这种方式是临时生效，重启系统又会还原，彻底关闭，则需要修改/etc/selinux/config，配置
> SELINUX=disabled

这是比较暴力的方式，再复杂的就要研究SELinux的配置了。

如果还是无法访问，检查防火墙是否配置规则。

“暴力”的方式是，关闭防火墙（判断如果是这个问题，再可以做相应配置）：
> service iptables stop 

如果是systemd管理的firewalld（CentOS 7.x），则：
> systemctl stop firewalld

然后，配置相应的端口开放规则，再启动防火墙。

